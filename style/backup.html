<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleek - Discover Your Color</title>
    <!-- Tailwind CSS for rapid styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons for lightweight, crisp icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* Custom Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fafafa;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar for Cart */
        .cart-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .cart-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .cart-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Product Card Hover Effect */
        .product-card .actions {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        .product-card:hover .actions {
            opacity: 1;
            transform: translateY(0);
        }

        /* Loader Animation */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Animation */
        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #7ac142;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .checkmark {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #fff;
            stroke-miterlimit: 10;
            margin: 10% auto;
            box-shadow: inset 0px 0px 0px #7ac142;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke {
            100% { stroke-dashoffset: 0; }
        }
        @keyframes scale {
            0%, 100% { transform: none; }
            50% { transform: scale3d(1.1, 1.1, 1); }
        }
        @keyframes fill {
            100% { box-shadow: inset 0px 0px 0px 30px #7ac142; }
        }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <!-- HEADER -->
    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="w-8 h-8 bg-gray-900 text-white flex items-center justify-center rounded-full font-bold">F</div>
                    <span class="font-semibold text-lg tracking-tight">Fleek</span>
                </div>

                <!-- Nav Icons -->
                <div class="flex items-center gap-6">
                    <button class="text-gray-500 hover:text-gray-900 transition"><i class="ph ph-magnifying-glass text-xl"></i></button>
                    <button class="relative text-gray-900 hover:text-green-600 transition" id="cart-btn">
                        <i class="ph ph-shopping-bag text-2xl"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-green-500 text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center transform scale-0 transition-transform duration-300">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        
        <!-- Header Section -->
        <div class="flex justify-between items-end mb-8">
            <div>
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-2">Discover your color</h1>
                <p class="text-gray-500">Curated styles just for you.</p>
            </div>
            <a href="#" class="hidden sm:block text-sm font-medium text-gray-900 underline hover:text-green-600">View all</a>
        </div>

        <!-- Filters (Visual only for design match) -->
        <div class="flex gap-3 mb-8 overflow-x-auto pb-2 no-scrollbar">
            <button class="px-4 py-2 bg-gray-900 text-white rounded-full text-sm whitespace-nowrap">All Items</button>
            <button class="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-full text-sm whitespace-nowrap hover:border-gray-900">Coats</button>
            <button class="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-full text-sm whitespace-nowrap hover:border-gray-900">Dresses</button>
            <button class="px-4 py-2 bg-white border border-gray-200 text-gray-600 rounded-full text-sm whitespace-nowrap hover:border-gray-900">Accessories</button>
        </div>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-10">
            <!-- Loading Skeletons will be injected here -->
            <div class="animate-pulse">
                <div class="bg-gray-200 rounded-lg h-96 w-full mb-4"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-1/4"></div>
            </div>
            <div class="animate-pulse hidden sm:block">
                <div class="bg-gray-200 rounded-lg h-96 w-full mb-4"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-1/4"></div>
            </div>
            <div class="animate-pulse hidden lg:block">
                <div class="bg-gray-200 rounded-lg h-96 w-full mb-4"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-1/4"></div>
            </div>
            <div class="animate-pulse hidden lg:block">
                <div class="bg-gray-200 rounded-lg h-96 w-full mb-4"></div>
                <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div class="h-4 bg-gray-200 rounded w-1/4"></div>
            </div>
        </div>
    </main>

    <!-- CART MODAL / SIDEBAR -->
    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-50 hidden transition-opacity opacity-0" aria-hidden="true"></div>
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white z-50 transform translate-x-full transition-transform duration-300 shadow-2xl flex flex-col">
        <!-- Cart Header -->
        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-white">
            <h2 class="text-lg font-bold">Shopping Cart</h2>
            <button id="close-cart" class="p-2 hover:bg-gray-100 rounded-full transition"><i class="ph ph-x text-xl"></i></button>
        </div>

        <!-- Cart Items Container -->
        <div id="cart-items" class="flex-1 overflow-y-auto p-5 cart-scroll space-y-6">
            <!-- Empty State -->
            <div class="h-full flex flex-col items-center justify-center text-gray-400">
                <i class="ph ph-shopping-cart text-6xl mb-4 text-gray-200"></i>
                <p>Your cart is empty.</p>
                <button onclick="document.getElementById('close-cart').click()" class="mt-4 text-green-600 font-medium hover:underline">Start Shopping</button>
            </div>
        </div>

        <!-- Cart Footer -->
        <div class="p-6 bg-gray-50 border-t border-gray-100">
            <div class="flex justify-between items-center mb-4">
                <span class="text-gray-500">Subtotal</span>
                <span id="cart-total" class="text-xl font-bold text-gray-900">$0.00</span>
            </div>
            <p class="text-xs text-gray-400 mb-4 text-center">Shipping and taxes calculated at checkout.</p>
            <button id="pay-btn" class="w-full bg-gray-900 text-white py-4 rounded-lg font-medium hover:bg-gray-800 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Pay Now
            </button>
        </div>
    </div>

    <!-- PAYMENT MODAL (Simulated Razorpay) -->
    <div id="payment-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden transform transition-all scale-95 opacity-0" id="payment-modal-content">
            <!-- Header -->
            <div class="bg-[#3395ff] px-6 py-4 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-white rounded text-[#3395ff] flex items-center justify-center font-bold">R</div>
                    <span class="text-white font-bold tracking-wide">Razorpay Trusted</span>
                </div>
                <div class="text-white/80 text-sm">Test Mode</div>
            </div>
            
            <!-- Body -->
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-gray-500">Amount to Pay</span>
                    <span id="payment-amount" class="text-2xl font-bold text-gray-800">$0.00</span>
                </div>

                <!-- Payment Methods -->
                <div class="space-y-3">
                    <div class="border rounded-lg p-3 flex items-center gap-3 cursor-pointer hover:border-blue-500 bg-blue-50 border-blue-500">
                        <i class="ph-fill ph-credit-card text-blue-600 text-xl"></i>
                        <span class="font-medium text-gray-700">Card</span>
                        <i class="ph-fill ph-check-circle text-blue-600 ml-auto"></i>
                    </div>
                    <div class="border rounded-lg p-3 flex items-center gap-3 cursor-pointer hover:border-gray-300 opacity-60">
                        <i class="ph-fill ph-bank text-gray-500 text-xl"></i>
                        <span class="font-medium text-gray-700">Netbanking</span>
                    </div>
                    <div class="border rounded-lg p-3 flex items-center gap-3 cursor-pointer hover:border-gray-300 opacity-60">
                        <i class="ph-fill ph-wallet text-gray-500 text-xl"></i>
                        <span class="font-medium text-gray-700">Wallet</span>
                    </div>
                </div>

                <button id="confirm-payment" class="mt-8 w-full bg-[#3395ff] text-white py-3 rounded font-bold shadow-lg shadow-blue-200 hover:bg-[#2b84e6] transition flex justify-center items-center gap-2">
                    <span>Pay Now</span>
                </button>
            </div>
        </div>
    </div>

    <!-- SUCCESS OVERLAY -->
    <div id="success-overlay" class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-white">
        <div class="text-center p-8">
            <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <h2 class="text-2xl font-bold text-gray-900 mt-6 mb-2">Payment Successful!</h2>
            <p class="text-gray-500 mb-8">Thank you for your purchase. Your order is on its way.</p>
            <button onclick="location.reload()" class="px-6 py-2 bg-gray-900 text-white rounded-full hover:bg-gray-800 transition">Continue Shopping</button>
        </div>
    </div>


    <!-- JAVASCRIPT LOGIC -->
    <script>
        /**
         * ==========================================
         * 1. SERVICE LAYER (service.js)
         * Handles API calls and data fetching
         * ==========================================
         */
        class ProductService {
            static BASE_URL = 'https://fakestoreapi.com/products/category/women\'s clothing';
            static BASE_URL_ALT = 'https://fakestoreapi.com/products/category/men\'s clothing';

            // Fetch mixed products to make the grid interesting
            static async fetchProducts() {
                try {
                    const [res1, res2] = await Promise.all([
                        fetch(this.BASE_URL),
                        fetch(this.BASE_URL_ALT)
                    ]);
                    
                    const women = await res1.json();
                    const men = await res2.json();
                    
                    // Combine and limit to 8 items for design balance
                    return [...women, ...men].slice(0, 8); 
                } catch (error) {
                    console.error("Failed to fetch products:", error);
                    return [];
                }
            }
        }

        /**
         * ==========================================
         * 2. MODEL LAYER (model.js)
         * Manages application state (Cart data)
         * ==========================================
         */
        class CartModel {
            constructor() {
                this.items = []; // Array of { product, quantity }
                this.listeners = [];
            }

            addItem(product) {
                const existingItem = this.items.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    this.items.push({ ...product, quantity: 1 });
                }
                this.notify();
            }

            removeItem(productId) {
                this.items = this.items.filter(item => item.id !== productId);
                this.notify();
            }

            updateQuantity(productId, delta) {
                const item = this.items.find(item => item.id === productId);
                if (item) {
                    item.quantity += delta;
                    if (item.quantity <= 0) {
                        this.removeItem(productId);
                    } else {
                        this.notify();
                    }
                }
            }

            clearCart() {
                this.items = [];
                this.notify();
            }

            getTotal() {
                return this.items.reduce((total, item) => total + (item.price * item.quantity), 0);
            }

            getCount() {
                return this.items.reduce((count, item) => count + item.quantity, 0);
            }

            // Observer pattern to notify View
            subscribe(listener) {
                this.listeners.push(listener);
            }

            notify() {
                this.listeners.forEach(listener => listener(this.items, this.getTotal(), this.getCount()));
            }
        }

        /**
         * ==========================================
         * 3. VIEW LAYER (view.js)
         * Handles DOM updates and Rendering
         * ==========================================
         */
        class UI {
            constructor() {
                this.grid = document.getElementById('product-grid');
                this.cartBadge = document.getElementById('cart-count');
                this.cartSidebar = document.getElementById('cart-sidebar');
                this.cartOverlay = document.getElementById('cart-overlay');
                this.cartItemsContainer = document.getElementById('cart-items');
                this.cartTotal = document.getElementById('cart-total');
                this.payBtn = document.getElementById('pay-btn');
                this.paymentModal = document.getElementById('payment-modal');
                this.paymentContent = document.getElementById('payment-modal-content');
                this.paymentAmount = document.getElementById('payment-amount');
                this.successOverlay = document.getElementById('success-overlay');
            }

            // Render Product Grid
            renderProducts(products, onAddClick) {
                this.grid.innerHTML = ''; // Clear skeletons
                
                products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'group relative flex flex-col gap-2';
                    
                    // Random "colors" for design match
                    const colors = ['bg-[#5c7a64]', 'bg-[#7a3e3e]', 'bg-[#e5e5e5]'];
                    
                    card.innerHTML = `
                        <div class="product-card relative w-full h-96 overflow-hidden rounded-lg bg-gray-100 group">
                            <img src="${product.image}" alt="${product.title}" class="h-full w-full object-contain p-8 mix-blend-multiply transition-transform duration-500 group-hover:scale-105">
                            
                            <!-- Badges -->
                            ${product.id % 2 === 0 ? '<span class="absolute top-3 left-3 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">-50%</span>' : ''}
                            ${product.id % 3 === 0 ? '<span class="absolute top-3 left-3 bg-gray-900 text-white text-xs font-bold px-2 py-1 rounded">New</span>' : ''}

                            <!-- Hover Action -->
                            <div class="actions absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/10 to-transparent">
                                <button class="add-to-cart-btn w-full bg-white text-gray-900 py-3 rounded-md shadow-lg font-medium hover:bg-gray-900 hover:text-white transition flex items-center justify-center gap-2" data-id="${product.id}">
                                    <span>Add to cart</span>
                                    <i class="ph-bold ph-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mt-2">
                            <h3 class="text-sm font-medium text-gray-900 truncate">${product.title}</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="font-bold text-gray-900">$${product.price}</span>
                                ${product.id % 2 === 0 ? `<span class="text-sm text-gray-400 line-through">$${(product.price * 2).toFixed(2)}</span>` : ''}
                            </div>
                            <!-- Color Swatches -->
                            <div class="flex gap-1 mt-2">
                                <div class="w-4 h-4 rounded-full ${colors[0]} cursor-pointer ring-1 ring-offset-1 ring-transparent hover:ring-gray-300"></div>
                                <div class="w-4 h-4 rounded-full ${colors[1]} cursor-pointer ring-1 ring-offset-1 ring-transparent hover:ring-gray-300"></div>
                            </div>
                        </div>
                    `;
                    
                    // Attach event listener specifically to this button
                    const btn = card.querySelector('.add-to-cart-btn');
                    btn.addEventListener('click', () => onAddClick(product));
                    
                    this.grid.appendChild(card);
                });
            }

            // Update Cart UI
            updateCart(items, total, count) {
                // Update Badge
                this.cartBadge.innerText = count;
                if(count > 0) {
                    this.cartBadge.classList.remove('scale-0');
                    this.cartBadge.classList.add('scale-100');
                    this.payBtn.disabled = false;
                } else {
                    this.cartBadge.classList.remove('scale-100');
                    this.cartBadge.classList.add('scale-0');
                    this.payBtn.disabled = true;
                }

                this.cartTotal.innerText = `$${total.toFixed(2)}`;
                this.paymentAmount.innerText = `$${total.toFixed(2)}`;

                // Render List
                if (items.length === 0) {
                    this.cartItemsContainer.innerHTML = `
                        <div class="h-full flex flex-col items-center justify-center text-gray-400">
                            <i class="ph ph-shopping-cart text-6xl mb-4 text-gray-200"></i>
                            <p>Your cart is empty.</p>
                            <button onclick="document.getElementById('close-cart').click()" class="mt-4 text-green-600 font-medium hover:underline">Start Shopping</button>
                        </div>
                    `;
                    return;
                }

                this.cartItemsContainer.innerHTML = '';
                items.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'flex gap-4 p-4 bg-white border border-gray-100 rounded-lg hover:shadow-sm transition';
                    el.innerHTML = `
                        <div class="w-20 h-20 bg-gray-50 rounded flex items-center justify-center p-2 shrink-0">
                            <img src="${item.image}" class="h-full w-full object-contain mix-blend-multiply">
                        </div>
                        <div class="flex-1 flex flex-col justify-between">
                            <div>
                                <h4 class="text-sm font-medium text-gray-900 line-clamp-1">${item.title}</h4>
                                <p class="text-xs text-gray-500 mt-1">Variant: Default</p>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="font-bold text-sm">$${(item.price * item.quantity).toFixed(2)}</span>
                                <div class="flex items-center bg-gray-100 rounded-full px-2 py-1 gap-3">
                                    <button class="text-gray-500 hover:text-gray-900 text-xs dec-btn" data-id="${item.id}"><i class="ph-bold ph-minus"></i></button>
                                    <span class="text-xs font-medium w-3 text-center">${item.quantity}</span>
                                    <button class="text-gray-500 hover:text-gray-900 text-xs inc-btn" data-id="${item.id}"><i class="ph-bold ph-plus"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                    this.cartItemsContainer.appendChild(el);
                });
            }

            toggleCart(isOpen) {
                if (isOpen) {
                    this.cartOverlay.classList.remove('hidden');
                    // Small delay to allow display:block to apply before opacity transition
                    setTimeout(() => {
                        this.cartOverlay.classList.remove('opacity-0');
                        this.cartSidebar.classList.remove('translate-x-full');
                    }, 10);
                } else {
                    this.cartOverlay.classList.add('opacity-0');
                    this.cartSidebar.classList.add('translate-x-full');
                    setTimeout(() => {
                        this.cartOverlay.classList.add('hidden');
                    }, 300);
                }
            }

            togglePaymentModal(isOpen) {
                if (isOpen) {
                    this.paymentModal.classList.remove('hidden');
                    setTimeout(() => {
                        this.paymentContent.classList.remove('scale-95', 'opacity-0');
                        this.paymentContent.classList.add('scale-100', 'opacity-100');
                    }, 10);
                } else {
                    this.paymentContent.classList.remove('scale-100', 'opacity-100');
                    this.paymentContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        this.paymentModal.classList.add('hidden');
                    }, 200);
                }
            }

            showSuccess() {
                this.successOverlay.classList.remove('hidden');
            }
        }

        /**
         * ==========================================
         * 4. CONTROLLER LAYER (controller.js)
         * Connects User Input -> Model -> View
         * ==========================================
         */
        class Controller {
            constructor(model, view) {
                this.model = model;
                this.view = view;
            }

            async init() {
                // Initialize View listeners
                this.view.cartBadge.parentElement.addEventListener('click', () => this.view.toggleCart(true));
                document.getElementById('close-cart').addEventListener('click', () => this.view.toggleCart(false));
                this.view.cartOverlay.addEventListener('click', () => this.view.toggleCart(false));

                // Cart Item Quantity Buttons (Event Delegation)
                this.view.cartItemsContainer.addEventListener('click', (e) => {
                    const incBtn = e.target.closest('.inc-btn');
                    const decBtn = e.target.closest('.dec-btn');
                    
                    if (incBtn) this.model.updateQuantity(parseInt(incBtn.dataset.id), 1);
                    if (decBtn) this.model.updateQuantity(parseInt(decBtn.dataset.id), -1);
                });

                // Pay Button
                this.view.payBtn.addEventListener('click', () => {
                    this.view.toggleCart(false);
                    this.view.togglePaymentModal(true);
                });

                // Confirm Payment (Fake Razorpay Logic)
                document.getElementById('confirm-payment').addEventListener('click', (e) => {
                    const btn = e.currentTarget;
                    const originalText = btn.innerHTML;
                    
                    // Loading State
                    btn.innerHTML = '<div class="loader w-5 h-5 border-white border-t-transparent"></div>';
                    btn.disabled = true;

                    // Simulate API Delay
                    setTimeout(() => {
                        this.view.togglePaymentModal(false);
                        this.view.showSuccess();
                        this.model.clearCart();
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 2000);
                });

                // Subscribe View to Model
                this.model.subscribe((items, total, count) => {
                    this.view.updateCart(items, total, count);
                });

                // Fetch Data
                const products = await ProductService.fetchProducts();
                this.view.renderProducts(products, (product) => {
                    this.model.addItem(product);
                    
                    // Optional: Open cart momentarily or show toast (Design choice: just update badge)
                    // Let's flash the cart badge
                    const badge = document.getElementById('cart-count');
                    badge.classList.add('scale-125', 'bg-green-600');
                    setTimeout(() => badge.classList.remove('scale-125', 'bg-green-600'), 200);
                });
            }
        }

        // --- Bootstrap the App ---
        document.addEventListener('DOMContentLoaded', () => {
            const appState = new CartModel();
            const appUI = new UI();
            const appController = new Controller(appState, appUI);
            
            appController.init();
        });

    </script>
</body>
</html>